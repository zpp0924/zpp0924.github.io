<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>装修人工费计算器</title>
    
    <!-- PWA 配置 -->
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="装修计算器">
    <meta name="description" content="专业的装修人工费计算工具，支持多房间计算和实时单价调整">
    
    <!-- 清单文件 -->
    <link rel="manifest" href="./manifest.json">
    
    <!-- 样式 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* PWA 安装提示样式 */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: #2563eb;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .install-prompt.show {
            display: block;
        }
        
        /* 移动端优化 */
        @media (max-width: 640px) {
            .grid-cols-2 {
                gap: 0.5rem;
            }
            
            input {
                font-size: 16px; /* 防止iOS缩放 */
            }
        }
        
        /* 隐藏数字输入框的箭头 */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- PWA 安装提示 -->
    <div id="installPrompt" class="install-prompt">
        <div class="flex items-center justify-between">
            <div class="flex-1">
                <div class="font-semibold">安装到主屏幕</div>
                <div class="text-sm opacity-90">像APP一样使用装修计算器</div>
            </div>
            <div class="flex gap-2 ml-4">
                <button id="installBtn" class="bg-white text-blue-600 px-3 py-1 rounded text-sm font-medium">
                    安装
                </button>
                <button id="dismissBtn" class="text-white opacity-75 hover:opacity-100 px-2">
                    ✕
                </button>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // 图标组件
        const PlusIcon = () => (
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );
        
        const XIcon = () => (
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );
        
        const EditIcon = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
        );
        
        const CalculatorIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="4" y="2" width="16" height="20" rx="2"></rect>
                <line x1="8" y1="6" x2="16" y2="6"></line>
                <line x1="8" y1="10" x2="16" y2="10"></line>
                <line x1="8" y1="14" x2="16" y2="14"></line>
                <line x1="8" y1="18" x2="16" y2="18"></line>
            </svg>
        );
        
        const SettingsIcon = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
        );

        const DecorationCalculator = () => {
          const [activeTab, setActiveTab] = useState(0);
          const [showPriceModal, setShowPriceModal] = useState(false);
          const [showSummary, setShowSummary] = useState(false);
          
          // 默认房间列表
          const [rooms, setRooms] = useState([
            { id: 1, name: '主卧', data: {} },
            { id: 2, name: '次卧', data: {} },
            { id: 3, name: '儿童房', data: {} },
            { id: 4, name: '老人房', data: {} },
            { id: 5, name: '客厅', data: {} },
            { id: 6, name: '厨房', data: {} },
            { id: 7, name: '阳台', data: {} },
            { id: 8, name: '入户走廊', data: {} },
            { id: 9, name: '公卫走廊', data: {} },
            { id: 10, name: '干区', data: {} }
          ]);
          
          // 单价设置
          const [prices, setPrices] = useState(() => {
            const saved = localStorage.getItem('decorationPrices');
            return saved ? JSON.parse(saved) : {
              平顶: 25,
              柜头顶: 30,
              窗帘盒: 15,
              沿板线: 8,
              单眼皮: 10,
              双眼皮: 12,
              集成吊顶: 35
            };
          });
          
          // 保存数据到本地存储
          useEffect(() => {
            localStorage.setItem('decorationRooms', JSON.stringify(rooms));
          }, [rooms]);
          
          useEffect(() => {
            localStorage.setItem('decorationPrices', JSON.stringify(prices));
          }, [prices]);
          
          // 从本地存储加载房间数据
          useEffect(() => {
            const savedRooms = localStorage.getItem('decorationRooms');
            if (savedRooms) {
              setRooms(JSON.parse(savedRooms));
            }
          }, []);
          
          // 添加房间
          const addRoom = () => {
            const newId = Math.max(...rooms.map(r => r.id)) + 1;
            setRooms([...rooms, { id: newId, name: `房间${newId}`, data: {} }]);
          };
          
          // 删除房间
          const deleteRoom = (id) => {
            if (rooms.length > 1) {
              setRooms(rooms.filter(r => r.id !== id));
              if (activeTab >= rooms.length - 1) {
                setActiveTab(Math.max(0, activeTab - 1));
              }
            }
          };
          
          // 重命名房间
          const renameRoom = (id, newName) => {
            setRooms(rooms.map(r => r.id === id ? { ...r, name: newName } : r));
          };
          
          // 更新房间数据
          const updateRoomData = (roomId, field, value) => {
            setRooms(rooms.map(r => 
              r.id === roomId 
                ? { ...r, data: { ...r.data, [field]: parseFloat(value) || 0 } }
                : r
            ));
          };
          
          // 计算单个房间总价
          const calculateRoomTotal = (roomData) => {
            const {
              平顶长 = 0, 平顶宽 = 0,
              柜头顶长 = 0, 柜头顶宽 = 0,
              窗帘盒个数 = 0,
              沿板线长度 = 0,
              单眼皮长度 = 0,
              双眼皮长度 = 0,
              集成吊顶长 = 0, 集成吊顶宽 = 0
            } = roomData;
            
            const 平顶面积 = (平顶长 * 平顶宽) / 1000000; // 毫米转平米
            const 柜头顶面积 = (柜头顶长 * 柜头顶宽) / 1000000;
            const 集成吊顶面积 = (集成吊顶长 * 集成吊顶宽) / 1000000;
            
            return (
              平顶面积 * prices.平顶 +
              柜头顶面积 * prices.柜头顶 +
              窗帘盒个数 * prices.窗帘盒 +
              (沿板线长度 / 1000) * prices.沿板线 +
              (单眼皮长度 / 1000) * prices.单眼皮 +
              (双眼皮长度 / 1000) * prices.双眼皮 +
              集成吊顶面积 * prices.集成吊顶
            );
          };
          
          // 计算总价
          const calculateTotal = () => {
            return rooms.reduce((total, room) => total + calculateRoomTotal(room.data), 0);
          };
          
          // 生成汇总报告
          const generateSummary = () => {
            let summary = '';
            let grandTotal = 0;
            
            rooms.forEach(room => {
              const data = room.data;
              const roomTotal = calculateRoomTotal(data);
              grandTotal += roomTotal;
              
              if (roomTotal > 0) {
                summary += `${room.name}:\n`;
                
                if (data.平顶长 && data.平顶宽) {
                  const area = (data.平顶长 * data.平顶宽) / 1000000;
                  summary += `  平顶: ${area.toFixed(2)}㎡ × ${prices.平顶}元 = ${(area * prices.平顶).toFixed(2)}元\n`;
                }
                
                if (data.柜头顶长 && data.柜头顶宽) {
                  const area = (data.柜头顶长 * data.柜头顶宽) / 1000000;
                  summary += `  柜头顶: ${area.toFixed(2)}㎡ × ${prices.柜头顶}元 = ${(area * prices.柜头顶).toFixed(2)}元\n`;
                }
                
                if (data.窗帘盒个数) {
                  summary += `  窗帘盒: ${data.窗帘盒个数}个 × ${prices.窗帘盒}元 = ${(data.窗帘盒个数 * prices.窗帘盒).toFixed(2)}元\n`;
                }
                
                if (data.沿板线长度) {
                  const length = data.沿板线长度 / 1000;
                  summary += `  沿板线: ${length.toFixed(2)}m × ${prices.沿板线}元 = ${(length * prices.沿板线).toFixed(2)}元\n`;
                }
                
                if (data.单眼皮长度) {
                  const length = data.单眼皮长度 / 1000;
                  summary += `  单眼皮: ${length.toFixed(2)}m × ${prices.单眼皮}元 = ${(length * prices.单眼皮).toFixed(2)}元\n`;
                }
                
                if (data.双眼皮长度) {
                  const length = data.双眼皮长度 / 1000;
                  summary += `  双眼皮: ${length.toFixed(2)}m × ${prices.双眼皮}元 = ${(length * prices.双眼皮).toFixed(2)}元\n`;
                }
                
                if (data.集成吊顶长 && data.集成吊顶宽) {
                  const area = (data.集成吊顶长 * data.集成吊顶宽) / 1000000;
                  summary += `  集成吊顶: ${area.toFixed(2)}㎡ × ${prices.集成吊顶}元 = ${(area * prices.集成吊顶).toFixed(2)}元\n`;
                }
                
                summary += `  小计: ${roomTotal.toFixed(2)}元\n\n`;
              }
            });
            
            summary += `总计: ${grandTotal.toFixed(2)}元`;
            return summary;
          };
          
          const currentRoom = rooms[activeTab];
          
          return (
            <div className="max-w-md mx-auto bg-white min-h-screen">
              {/* 顶部标题 */}
              <div className="bg-blue-600 text-white p-4 text-center font-bold text-lg">
                装修人工费计算器
              </div>
              
              {/* 房间选项卡 */}
              <div className="bg-gray-100 p-2 overflow-x-auto">
                <div className="flex space-x-2 min-w-max">
                  {rooms.map((room, index) => (
                    <div key={room.id} className="flex items-center">
                      <button
                        onClick={() => setActiveTab(index)}
                        className={`px-3 py-2 rounded text-sm font-medium ${
                          activeTab === index
                            ? 'bg-blue-600 text-white'
                            : 'bg-white text-gray-700 hover:bg-gray-50'
                        }`}
                      >
                        {room.name}
                      </button>
                      {rooms.length > 1 && (
                        <button
                          onClick={() => deleteRoom(room.id)}
                          className="ml-1 p-1 text-red-500 hover:bg-red-50 rounded"
                        >
                          <XIcon />
                        </button>
                      )}
                    </div>
                  ))}
                  <button
                    onClick={addRoom}
                    className="flex items-center px-3 py-2 bg-green-100 text-green-700 rounded text-sm font-medium hover:bg-green-200"
                  >
                    <PlusIcon />
                    <span className="ml-1">添加</span>
                  </button>
                </div>
              </div>
              
              {/* 房间编辑 */}
              <div className="p-4">
                <div className="flex items-center mb-4">
                  <input
                    type="text"
                    value={currentRoom.name}
                    onChange={(e) => renameRoom(currentRoom.id, e.target.value)}
                    className="font-bold text-lg bg-transparent border-b-2 border-gray-300 focus:border-blue-500 outline-none"
                  />
                  <EditIcon />
                </div>
                
                {/* 输入表单 */}
                <div className="space-y-6">
                  {/* 平顶 */}
                  <div className="bg-gray-50 p-4 rounded-lg">
                    <h3 className="font-semibold mb-3 text-gray-700">平顶</h3>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <label className="block text-sm text-gray-600 mb-1">长 (mm)</label>
                        <input
                          type="number"
                          value={currentRoom.data.平顶长 || ''}
                          onChange={(e) => updateRoomData(currentRoom.id, '平顶长', e.target.value)}
                          className="w-full p-2 border rounded focus:border-blue-500 outline-none"
                          placeholder="0"
                          inputMode="numeric"
                        />
                      </div>
                      <div>
                        <label className="block text-sm text-gray-600 mb-1">宽 (mm)</label>
                        <input
                          type="number"
                          value={currentRoom.data.平顶宽 || ''}
                          onChange={(e) => updateRoomData(currentRoom.id, '平顶宽', e.target.value)}
                          className="w-full p-2 border rounded focus:border-blue-500 outline-none"
                          placeholder="0"
                          inputMode="numeric"
                        />
                      </div>
                    </div>
                  </div>
                  
                  {/* 柜头顶 */}
                  <div className="bg-gray-50 p-4 rounded-lg">
                    <h3 className="font-semibold mb-3 text-gray-700">柜头顶</h3>
                    <div className="grid grid-cols-2 gap-3">
                      <div>
                        <label className="block text-sm text-gray-600 mb-1">长 (mm)</label>
                        <input
                          type="number"
                          value={currentRoom.data.柜头顶长 || ''}
                          onChange={(e) => updateRoomData(currentRoom.id, '柜头顶长', e.target.value)}
                          className="w-full p-2 border rounded focus:border-blue-500 outline-none"
                          placeholder="0"
                          inputMode="numeric"
                        />
                      </div>
                      <div>
                        <label className="block text-sm text-gray-600 mb-1">宽 (mm)</label>
                        <input
                          type="number"
                          value={currentRoom.data.柜头顶宽 || ''}
                          onChange={(e) => updateRoomData(currentRoom.id, '柜头顶宽', e.target.value)}
                          className="w-full p-2 border rounded focus:border-blue-500 outline-none"
                          placeholder="0"
                          inputMode="numeric"
                        />
                      </div>
                    </div>
                  </div>
                  
                  {/* 窗帘盒 */}
                  <div className="bg-gray-50 p-4 rounded-lg">
                    <h3 className="font-semibold mb-3 text-gray-700">窗帘盒</h3>
                    <div>
                      <label className="block text-sm text-gray-600 mb-1">个数</label>
                      <input
                        type="number"
                        value={currentRoom.data.窗帘盒个数 || ''}
                        onChange={(e) => updateRoomData(currentRoom.id, '窗帘盒个数', e.target.value)}
                        className="w-full p-2 border rounded focus:border-blue-500 outline-none"
                        placeholder="0"
                        inputMode="numeric"
                      />
                    </div>
                  </div>
                  
                  {/* 沿板线 */}
                  <div className="bg-gray-50 p-4 rounded-lg">
                    <h3 className="font-semibold mb-3 text-gray-700">沿板线</h3>
                    <div className="space-y-3">
                      <div>
                        <label className="block text-sm text-gray-600 mb-1">纯沿板线长度 (mm)</label>
                        <input
                          type="number"
                          value={currentRoom.data.沿板线长度 || ''}
                          onChange={(e) => updateRoomData(currentRoom.id, '沿板线长度', e.target.value)}
                          className="w-full p-2 border rounded focus:border-blue-500 outline-none"
                          placeholder="0"
                          inputMode="numeric"
                        />
                      </div>
                      <div>
                        <label className="block text-sm text-gray-600 mb-1">单眼皮长度 (mm)</label>
                        <input
                          type="number"
                          value={currentRoom.data.单眼皮长度 || ''}
                          onChange={(e) => updateRoomData(currentRoom.id, '单眼皮长度', e.target.value)}
                          className="w-full p-2 border rounded focus:border-blue-500 outline-none"
                          placeholder="0"
                          inputMode="numeric"
                        />
                      </div>
                      <div>
                        <label className="block text-sm text-gray-600 mb-1">双眼皮长度 (mm)</label>
                        <input
                          type="number"
                          value={currentRoom.data.双眼皮长度 || ''}
                          onChange={(e) => updateRoomData(currentRoom.id, '双眼皮长度', e.target.value)}
                          className="w-full p-2 border rounded focus:border-blue-500 outline-none"
                          placeholder="0"
                          inputMode="numeric"
                        />
                      </div>
                    </div>
                  </div>
                  
                  {/* 集成吊顶 - 只在厨房、卫生间显示 */}
                  {['厨房', '主卫', '公卫', '卫生间'].some(keyword => currentRoom.name.includes(keyword)) && (
                    <div className="bg-gray-50 p-4 rounded-lg">
                      <h3 className="font-semibold mb-3 text-gray-700">集成吊顶</h3>
                      <div className="grid grid-cols-2 gap-3">
                        <div>
                          <label className="block text-sm text-gray-600 mb-1">长 (mm)</label>
                          <input
                            type="number"
                            value={currentRoom.data.集成吊顶长 || ''}
                            onChange={(e) => updateRoomData(currentRoom.id, '集成吊顶长', e.target.value)}
                            className="w-full p-2 border rounded focus:border-blue-500 outline-none"
                            placeholder="0"
                            inputMode="numeric"
                          />
                        </div>
                        <div>
                          <label className="block text-sm text-gray-600 mb-1">宽 (mm)</label>
                          <input
                            type="number"
                            value={currentRoom.data.集成吊顶宽 || ''}
                            onChange={(e) => updateRoomData(currentRoom.id, '集成吊顶宽', e.target.value)}
                            className="w-full p-2 border rounded focus:border-blue-500 outline-none"
                            placeholder="0"
                            inputMode="numeric"
                          />
                        </div>
                      </div>
                    </div>
                  )}
                </div>
                
                {/* 当前房间小计 */}
                <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                  <div className="flex justify-between items-center">
                    <span className="font-semibold text-blue-800">当前房间小计:</span>
                    <span className="font-bold text-blue-800 text-lg">
                      ¥{calculateRoomTotal(currentRoom.data).toFixed(2)}
                    </span>
                  </div>
                </div>
                
                {/* 全部房间汇总 */}
                <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                  <h3 className="font-semibold text-gray-800 mb-4">全部房间汇总</h3>
                  <div className="space-y-4">
                    {rooms.map(room => {
                      const roomTotal = calculateRoomTotal(room.data);
                      if (roomTotal === 0) return null;
                      
                      return (
                        <div key={room.id} className="bg-white p-3 rounded border">
                          <div className="flex justify-between items-center mb-2">
                            <h4 className="font-semibold text-gray-700">{room.name}</h4>
                            <span className="font-bold text-blue-600">¥{roomTotal.toFixed(2)}</span>
                          </div>
                          
                          <div className="space-y-1 text-sm text-gray-600">
                            {room.data.平顶长 && room.data.平顶宽 && (
                              <div className="flex justify-between">
                                <span>平顶: {room.data.平顶长}×{room.data.平顶宽}={((room.data.平顶长 * room.data.平顶宽) / 1000000).toFixed(2)}㎡</span>
                                <span>¥{((room.data.平顶长 * room.data.平顶宽) / 1000000 * prices.平顶).toFixed(2)}</span>
                              </div>
                            )}
                            
                            {room.data.柜头顶长 && room.data.柜头顶宽 && (
                              <div className="flex justify-between">
                                <span>柜头顶: {room.data.柜头顶长}×{room.data.柜头顶宽}={((room.data.柜头顶长 * room.data.柜头顶宽) / 1000000).toFixed(2)}㎡</span>
                                <span>¥{((room.data.柜头顶长 * room.data.柜头顶宽) / 1000000 * prices.柜头顶).toFixed(2)}</span>
                              </div>
                            )}
                            
                            {room.data.窗帘盒个数 && (
                              <div className="flex justify-between">
                                <span>窗帘盒: {room.data.窗帘盒个数}个</span>
                                <span>¥{(room.data.窗帘盒个数 * prices.窗帘盒).toFixed(2)}</span>
                              </div>
                            )}
                            
                            {room.data.沿板线长度 && (
                              <div className="flex justify-between">
                                <span>沿板线: {(room.data.沿板线长度 / 1000).toFixed(2)}m</span>
                                <span>¥{(room.data.沿板线长度 / 1000 * prices.沿板线).toFixed(2)}</span>
                              </div>
                            )}
                            
                            {room.data.单眼皮长度 && (
                              <div className="flex justify-between">
                                <span>单眼皮: {(room.data.单眼皮长度 / 1000).toFixed(2)}m</span>
                                <span>¥{(room.data.单眼皮长度 / 1000 * prices.单眼皮).toFixed(2)}</span>
                              </div>
                            )}
                            
                            {room.data.双眼皮长度 && (
                              <div className="flex justify-between">
                                <span>双眼皮: {(room.data.双眼皮长度 / 1000).toFixed(2)}m</span>
                                <span>¥{(room.data.双眼皮长度 / 1000 * prices.双眼皮).toFixed(2)}</span>
                              </div>
                            )}
                            
                            {room.data.集成吊顶长 && room.data.集成吊顶宽 && ['厨房', '主卫', '公卫', '卫生间'].some(keyword => room.name.includes(keyword)) && (
                              <div className="flex justify-between">
                                <span>集成吊顶: {room.data.集成吊顶长}×{room.data.集成吊顶宽}={((room.data.集成吊顶长 * room.data.集成吊顶宽) / 1000000).toFixed(2)}㎡</span>
                                <span>¥{((room.data.集成吊顶长 * room.data.集成吊顶宽) / 1000000 * prices.集成吊顶).toFixed(2)}</span>
                              </div>
                            )}
                          </div>
                        </div>
                      );
                    })}
                  </div>
                  
                  {/* 总计 */}
                  <div className="mt-4 pt-4 border-t-2 border-gray-300">
                    <div className="flex justify-between items-center">
                      <span className="font-bold text-lg text-gray-800">总计:</span>
                      <span className="font-bold text-xl text-red-600">
                        ¥{calculateTotal().toFixed(2)}
                      </span>
                    </div>
                  </div>
                  
                  {/* 单价全局修改 */}
                  <div className="mt-4 pt-4 border-t border-gray-300">
                    <h4 className="font-semibold text-gray-700 mb-3">单价设置</h4>
                    <div className="grid grid-cols-2 gap-3">
                      <div className="space-y-2">
                        <div className="text-sm font-medium text-gray-600">按面积计算</div>
                        <div className="flex items-center justify-between">
                          <span className="text-xs text-gray-500">平顶</span>
                          <div className="flex items-center">
                            <input
                              type="number"
                              value={prices.平顶}
                              onChange={(e) => setPrices(prev => ({ ...prev, 平顶: parseFloat(e.target.value) || 0 }))}
                              className="w-12 p-1 border rounded text-center text-xs"
                              inputMode="numeric"
                            />
                            <span className="ml-1 text-xs text-gray-500">元/㎡</span>
                          </div>
                        </div>
                        <div className="flex items-center justify-between">
                          <span className="text-xs text-gray-500">柜头顶</span>
                          <div className="flex items-center">
                            <input
                              type="number"
                              value={prices.柜头顶}
                              onChange={(e) => setPrices(prev => ({ ...prev, 柜头顶: parseFloat(e.target.value) || 0 }))}
                              className="w-12 p-1 border rounded text-center text-xs"
                              inputMode="numeric"
                            />
                            <span className="ml-1 text-xs text-gray-500">元/㎡</span>
                          </div>
                        </div>
                        <div className="flex items-center justify-between">
                          <span className="text-xs text-gray-500">集成吊顶</span>
                          <div className="flex items-center">
                            <input
                              type="number"
                              value={prices.集成吊顶}
                              onChange={(e) => setPrices(prev => ({ ...prev, 集成吊顶: parseFloat(e.target.value) || 0 }))}
                              className="w-12 p-1 border rounded text-center text-xs"
                              inputMode="numeric"
                            />
                            <span className="ml-1 text-xs text-gray-500">元/㎡</span>
                          </div>
                        </div>
                      </div>
                      
                      <div className="space-y-2">
                        <div className="text-sm font-medium text-gray-600">按长度/个数计算</div>
                        <div className="flex items-center justify-between">
                          <span className="text-xs text-gray-500">沿板线</span>
                          <div className="flex items-center">
                            <input
                              type="number"
                              value={prices.沿板线}
                              onChange={(e) => setPrices(prev => ({ ...prev, 沿板线: parseFloat(e.target.value) || 0 }))}
                              className="w-12 p-1 border rounded text-center text-xs"
                              inputMode="numeric"
                            />
                            <span className="ml-1 text-xs text-gray-500">元/m</span>
                          </div>
                        </div>
                        <div className="flex items-center justify-between">
                          <span className="text-xs text-gray-500">单眼皮</span>
                          <div className="flex items-center">
                            <input
                              type="number"
                              value={prices.单眼皮}
                              onChange={(e) => setPrices(prev => ({ ...prev, 单眼皮: parseFloat(e.target.value) || 0 }))}
                              className="w-12 p-1 border rounded text-center text-xs"
                              inputMode="numeric"
                            />
                            <span className="ml-1 text-xs text-gray-500">元/m</span>
                          </div>
                        </div>
                        <div className="flex items-center justify-between">
                          <span className="text-xs text-gray-500">双眼皮</span>
                          <div className="flex items-center">
                            <input
                              type="number"
                              value={prices.双眼皮}
                              onChange={(e) => setPrices(prev => ({ ...prev, 双眼皮: parseFloat(e.target.value) || 0 }))}
                              className="w-12 p-1 border rounded text-center text-xs"
                              inputMode="numeric"
                            />
                            <span className="ml-1 text-xs text-gray-500">元/m</span>
                          </div>
                        </div>
                        <div className="flex items-center justify-between">
                          <span className="text-xs text-gray-500">窗帘盒</span>
                          <div className="flex items-center">
                            <input
                              type="number"
                              value={prices.窗帘盒}
                              onChange={(e) => setPrices(prev => ({ ...prev, 窗帘盒: parseFloat(e.target.value) || 0 }))}
                              className="w-12 p-1 border rounded text-center text-xs"
                              inputMode="numeric"
                            />
                            <span className="ml-1 text-xs text-gray-500">元/个</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                {/* 底部间距 */}
                <div className="h-20"></div>
              </div>
              
              {/* 悬浮按钮 */}
              <div className="fixed bottom-4 right-4 flex flex-col gap-2">
                <button
                  onClick={() => setShowSummary(true)}
                  className="bg-green-600 text-white p-3 rounded-full shadow-lg hover:bg-green-700 transition-colors"
                >
                  <CalculatorIcon />
                </button>
                <button
                  onClick={() => setShowPriceModal(true)}
                  className="bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition-colors"
                >
                  <SettingsIcon />
                </button>
              </div>
              
              {/* 单价设置模态框 */}
              {showPriceModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                  <div className="bg-white p-6 rounded-lg m-4 max-w-sm w-full">
                    <h3 className="text-lg font-bold mb-4">单价设置</h3>
                    <div className="space-y-4">
                      {Object.entries(prices).map(([key, value]) => (
                        <div key={key} className="flex justify-between items-center">
                          <label className="text-sm text-gray-700">{key}:</label>
                          <div className="flex items-center">
                            <input
                              type="number"
                              value={value}
                              onChange={(e) => setPrices(prev => ({ ...prev, [key]: parseFloat(e.target.value) || 0 }))}
                              className="w-16 p-1 border rounded text-center"
                              inputMode="numeric"
                            />
                            <span className="ml-1 text-sm text-gray-500">元</span>
                          </div>
                        </div>
                      ))}
                    </div>
                    <div className="flex justify-end mt-6">
                      <button
                        onClick={() => setShowPriceModal(false)}
                        className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                      >
                        确定
                      </button>
                    </div>
                  </div>
                </div>
              )}
              
              {/* 汇总报告模态框 */}
              {showSummary && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                  <div className="bg-white p-6 rounded-lg m-4 max-w-sm w-full max-h-96 overflow-y-auto">
                    <div className="flex justify-between items-center mb-4">
                      <h3 className="text-lg font-bold">工价汇总</h3>
                      <button
                        onClick={() => setShowSummary(false)}
                        className="text-gray-500 hover:text-gray-700"
                      >
                        <XIcon />
                      </button>
                    </div>
                    <div className="whitespace-pre-line text-sm text-gray-700 font-mono">
                      {generateSummary()}
                    </div>
                    <div className="mt-4 pt-4 border-t">
                      <div className="flex justify-between items-center">
                        <span className="font-bold text-red-600">总计:</span>
                        <span className="font-bold text-red-600 text-xl">
                          ¥{calculateTotal().toFixed(2)}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              )}
            </div>
          );
        };

        ReactDOM.render(<DecorationCalculator />, document.getElementById('root'));
    </script>

    <!-- PWA 功能脚本 -->
    <script>
        // 正确的Service Worker注册
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('./sw.js');
                    console.log('SW registered successfully:', registration);
                    
                    // 检查更新
                    registration.addEventListener('updatefound', () => {
                        console.log('SW update found');
                    });
                } catch (error) {
                    console.log('SW registration failed:', error);
                    // 如果Service Worker注册失败，使用基础功能
                    console.log('使用基础离线功能');
                }
            });
        } else {
            console.log('Service Worker not supported');
        }

        // PWA 安装提示
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');
        const dismissBtn = document.getElementById('dismissBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // 检查是否已经安装或已经显示过提示
            if (!localStorage.getItem('pwa-dismissed') && !window.matchMedia('(display-mode: standalone)').matches) {
                setTimeout(() => {
                    installPrompt.classList.add('show');
                }, 3000); // 3秒后显示提示
            }
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log('User choice:', outcome);
                deferredPrompt = null;
            }
            installPrompt.classList.remove('show');
        });

        dismissBtn.addEventListener('click', () => {
            installPrompt.classList.remove('show');
            localStorage.setItem('pwa-dismissed', 'true');
        });

        // 检测是否已安装为PWA
        window.addEventListener('appinstalled', () => {
            console.log('PWA已安装');
            installPrompt.classList.remove('show');
        });

        // 防止双击缩放
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (event) => {
            const now = (new Date()).getTime();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // 状态栏主题色
        const setThemeColor = (color) => {
            let themeColorMeta = document.querySelector('meta[name="theme-color"]');
            if (themeColorMeta) {
                themeColorMeta.setAttribute('content', color);
            }
        };

        // 设置主题色
        setThemeColor('#2563eb');
    </script>
</body>
</html>